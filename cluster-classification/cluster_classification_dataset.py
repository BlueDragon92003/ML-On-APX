from typing import Set

from torch.utils.data import Dataset
import h5py
import numpy

from data import DatasourceType
from cluster import ClusterType

class ClusterClassificationDataset(Dataset):
    """
    This class implements a PyTorch dataset for providing training and testing
    data generated by CMSSW to the model.
    """

    def __init__(self, datasource_type: DatasourceType, h5_files: Set[h5py.File]):
        """
        Setup the dataset with the provided source type (training or testing) and
        loaded h5 data file.
        """
        cluster_data = []
        tower_data = []

        for file in h5_files:
            # 'event_id', 'cluster_pt', 'cluster_eta', 'cluster_phi', 'cluster_wps', 'cluster_et5x5', 'cluster_seed_pt', 'cluster_timing', 'cluster_brems'
            cluster_data.append(file['clusters']['block0_values'])
            # 'event_id', 'tower_et', 'tower_eta', 'tower_phi', 'tower_hoe', 'tower_fb'
            tower_data.append(file['towers']['block0_values'])

        self.cluster_data = numpy.array(cluster_data)
        self.tower_data = numpy.array(tower_data)

    def __getitem__(self, index):
        """
        Overwrites the Dataset method. Provides a tuple of tensors to be given
        to the model for training or testing purposes. 
        """
        pass

    def __len__(self):
        """
        Overwrites the Dataset method. Provides an indication of how many elements
        are in this dataset.
        """
        pass
